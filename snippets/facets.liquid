{% comment %}
	Renders facets (filtering and sorting)

	Accepts:
	- results: {Object} Collection or Search object
	- enable_filtering: {Boolean} Show filtering when true
	- enable_sorting: {Boolean} Show sorting when true

	Usage:
{% render 'facets', results: collection, enable_filtering: true, enable_sorting: true %}
{% endcomment %}


{%- liquid
	assign sort_by = results.sort_by | default: results.default_sort_by
	assign total_active_values = 0
	if results.url
	assign results_url = results.url
	else
	assign terms = results.terms | escape
	assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
	endif 
-%}

	{% if enable_filtering %}
		<div class="facets__top facets small-hide">
			{% if enable_filtering %}
				<div class="active-facets active-facets-desktop">
					{% assign active_facets = false %}
					{%- for filter in results.filters -%}
						{% if filter.active_values.size > 0 or filter.min_value.value != null or filter.max_value.value != null %}
							{% assign active_facets = true %}
							{% break %}
						{% endif %}
					{% endfor %}

					<div class="active-facets__wrapper {% if active_facets %} active-facets__wrapper_margin {% endif %}">
						{%- for filter in results.filters -%}
							{%- for value in filter.active_values -%}
								<facet-remove>
									<a href="{{ value.url_to_remove }}" class="active-facets__button focus-inset">
										<span class="active-facets__button-inner">
											<span>{{ filter.label }}:</span> {{ value.label | escape }}
											<span class="active-facets__button-close">{% render 'icon-close' %}</span>
										</span>
										<span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
									</a>
								</facet-remove>
							{%- endfor -%}
							{% if filter.type == "price_range" %}
								{%- if filter.min_value.value != null or filter.max_value.value != null -%}
									<facet-remove>
										<a href="{{ filter.url_to_remove }}" class="active-facets__button focus-inset">
											<span class="active-facets__button-inner">
												<span>{{ filter.label }}:</span>
												{%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
												<span class="active-facets__button-close">{% render 'icon-close' %}</span>
											</span>
											<span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
										</a>
									</facet-remove>
								{%- endif -%}
							{% endif %}
						{%- endfor -%}
						<facet-remove>
							<a href="{{ results_url }}" class="active-facets__button-remove focus-inset">
								<span>{{ 'products.facets.clear_all' | t }}</span>
							</a>
						</facet-remove>
					</div>
				</div>
			{% endif %}
		</div>
	{% endif %}

	<div class="facets-container 
		{% if enable_filtering == false %} facets-container_no-filter {% endif %}
		facets-container--{{ filter_type }}">
		<facet-filters-form class="facets small-hide">
			{% if enable_filtering and filter_type == 'vertical' %}
				<button class="button button--unstyled facets__button-show no-js-hidden focus-inset">
					{% render 'icon-filter' %}
					<span class="label-hide">{{ 'products.facets.hide_filters' | t }}</span>
					<span class="label-show hidden">{{ 'products.facets.show_filters' | t }}</span>
				</button>
			{% endif %}
			<form id="FacetFiltersForm" class="facets__form facets__form--{{ filter_type }}">
				{%- if results.terms -%}
					<input type="hidden" name="q" value="{{ results.terms | escape }}">
					<input name="options[prefix]" type="hidden" value="last">
				{%- endif -%}

				<div class="facets__horizontal-top">
					{% if enable_filtering and filter_type == 'horizontal_united' %}
						<button type="button" class="button button--unstyled facets__button-show facets__button-show_up no-js-hidden focus-inset">
							{% render 'icon-filter' %}
							<span class="label-hide">{{ 'products.facets.hide_filters' | t }}</span>
							<span class="label-show hidden">{{ 'products.facets.show_filters' | t }}</span>
						</button>
					{% endif %}
					<div class="facets__sort-wrapper 
						{% if enable_filtering == false %} facets__sort-wrapper_no-filter {% endif %}
						{% if filter_type == 'vertical' %} facets__sort-wrapper_vertical {% endif %}" >
						<div class="facets__product-count" role="status">
							<h2 class="facets__product-count-text">
							<span id="ProductCountDesktop">
								{%- if results.results_count -%}
									{{ 'templates.search.results_count' | t: terms: results.terms, count: results.results_count }}
								{%- else -%}
									{{ 'products.facets.product_count_simple' | t: count: results.products_count }}
								{%- endif -%}
							</span>
							</h2>
						</div>
						{%- if enable_sorting -%}
							<div class="facet-filters facets-sorting sorting">
								<label class="facets-sorting__label" for="SortBy">{{ 'products.facets.sort_by_label' | t }}</label>
								<div class="facet-filters__field facets-sorting__field">
									<div class="select field">
										{%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
										<select name="sort_by" class="select__select" id="SortBy" aria-describedby="a11y-refresh-page-message">
											{%- for option in results.sort_options -%}
												<option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
											{%- endfor -%}
										</select>
										{% render 'icon-caret' %}
									</div>
								</div>
								<noscript>
									<button type="submit" class="button button--small focus-inset">{{ 'products.facets.sort_button' | t }}</button>
								</noscript>
							</div>
						{%- endif -%}
					
					</div>
				</div>

				{% if enable_filtering %}
					{% assign countFilters = results.filters | size %}
					<div class="facets__container">
						<div id="FacetsWrapperDesktop" class="facets__wrapper
							facets__wrapper--{{ filter_type }}">
							{%- for filter in results.filters -%}
								{% liquid
									assign presentation = filter.presentation | default: default_presentation
								%}
								{%- assign total_active_values = total_active_values | plus: filter.active_values.size -%}
								{% case filter.type %}
								{% when 'boolean', 'list' %}
									{% liquid
										assign color_trigger = settings.trigger_swatch | handle | strip
										assign name_option = filter.label | handle | strip 
									%}
									<details id="Details-{{ forloop.index }}-{{ section.id }}" 
										class="disclosure-has-popup facets__disclosure js-filter" data-index="{{ forloop.index }}" 
										{% if filter_type == 'horizontal_united' %} open {% elsif filter_type == 'vertical' and default_open %} open {% endif %}>
										<summary class="facets__summary focus-inset">
											<div class="facets__summary-inner">
												<span class="subtitle facets__summary-title">
													{{ filter.label | escape }}
													{% render 'icon-caret' %}
												</span>
											</div>
										</summary>
										<div id="Facet-{{ forloop.index }}-{{ section.id }}" class="facets__display">
											{% if filter_type == 'horizontal' %}
												<div class="facets__header">
													<span class="facets__selected no-js-hidden">
														{{ 'products.facets.filters_selected' | t: count: filter.active_values.size }}
													</span>
													<facet-remove>
														<a href="{{ filter.url_to_remove }}" class="facets__reset link focus-inset">
															{{ 'products.facets.reset' | t }}
														</a>
													</facet-remove>
												</div>
											{% endif %}
											<ul class="facets__list list-unstyled
												{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} facets__list--color 
												{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facets__list--color 
                        {% elsif presentation == 'image' %} facets__list--image {%- endif -%}" 
												role="list"
												style= "--image_filter_columns: {{ image_filter_columns }};"
											>
												{%- for value in filter.values -%}
													{% liquid
														if settings.type_color_swatch == 'custom' and color_trigger == name_option
															assign color_value = value.value | handle | strip
															assign color_value_custom = color_value
															
															if settings.custom_colors != blank
																assign custom_colors_string = settings.custom_colors | strip
																assign custom_colors_obj = custom_colors_string | newline_to_br | split: '<br />'

																for obj in custom_colors_obj
																	assign obj_strip = obj | strip
																	assign obj_key = obj_strip | split: ':' | first
																	assign obj_value = obj_strip | split: ':' | last
																	assign obj_color_name = obj_key | handle | strip

																	if color_value == obj_color_name
																		assign obj_color_value = obj_value
																		assign color_value_custom = obj_color_value | strip
																		break
																	endif
																endfor
															endif 
														endif

														assign swatch_value = null
                            if presentation == 'swatch'
                              assign swatch = value.swatch
                              if swatch.image
                                assign image_url = swatch.image | image_url: width: 50
                                assign swatch_value = 'url(' | append: image_url | append: ')'
                                assign swatch_focal_point = swatch.image.presentation.focal_point
                              elsif swatch.color
                                assign swatch_value = 'rgb(' | append: swatch.color.rgb | append: ')'
                              endif
                            endif
													%}
													<li class="list-menu__item facets__item
														{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} facets__item--color 
														{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} facets__item--color 
														{% elsif presentation == 'image' %} facets__item--image {%- endif -%}"
														{% if settings.type_color_swatch == 'custom' and color_trigger == name_option %}
                              style="--swatch-color: {{ color_value_custom | remove: '-' }}; --border-radius: {{ settings.swatch_border_radius }}px;"
                            {% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                              style="
                                --border-radius: {{ settings.swatch_border_radius }}px;
                                --swatch-color: {{ swatch_value }};
                                {% if swatch_focal_point %} --swatch-focal-point: {{ swatch_focal_point }}; {% endif %}
                              "
                            {% endif %}
													>
														<input type="checkbox" class="focus-inset"
															name="{{ value.param_name }}"
															value="{{ value.value }}"
															id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
															{% if value.active %}checked{% endif %}
														{% if value.count == 0 and value.active == false %}disabled{% endif %}
														>
														<label for="Filter-{{ filter.label | escape }}-{{ forloop.index }}" 
															class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}
															{%- if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} 
																facet-checkbox--color 
															{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%} facet-checkbox--color 
                              {% elsif presentation == 'image' %} facet-checkbox--image {%- endif -%}" 
															{%- if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} 
																title="{{- value.label -}}" 
															{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%}
																title="{{- value.label -}}" 
															{% endif %}
														>
															{%- if presentation == 'image' -%}
                                <div class="facets__image-wrapper" 
                                  style = "--image_filter_ratio: {{ image_filter_ratio }}; 
                                    --image_filter_fit: {{ image_filter_fit }};"
                                >
                                  {% liquid
                                    assign width = 1000 | divided_by: image_filter_columns
                                  %}
                                  {%- if value.image -%}
                                    {{
                                      value.image
                                      | image_url: width: width
                                      | image_tag: class: 'facets__image', alt: value.alt
                                    }}
                                  {%- endif -%}
                                </div>
                              {% else %}
																<svg class="icon icon-checkmark" width="8" height="7" viewBox="0 0 8 7" fill="none" xmlns="http://www.w3.org/2000/svg">
																	<path d="M1 3.5L3 5.5L7 1.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
																</svg>
															{% endif %}
															<span class="facet-checkbox__label 
																{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} visually-hidden 
																{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%} visually-hidden {%- endif -%}">
																{{ value.label | escape }} 
															</span>
														</label>
													</li>
												{%- endfor -%}
											</ul>
											{% if filter_type != 'horizontal' %}
												<facet-remove>
													<a href="{{ filter.url_to_remove }}" class="facets__reset link">
														{{ 'products.facets.reset' | t }}
													</a>
												</facet-remove>
											{% endif %}
										</div>
									</details>
								{% when 'price_range' %}
								{% liquid
									assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
									assign uses_comma_decimals = false
									if currencies_using_comma_decimals contains cart.currency.iso_code
									assign uses_comma_decimals = true
									endif %}

									{%- assign max_price_amount = filter.range_max | money | strip_html | escape -%}

									{% if filter.range_max != 0 %}
										<details id="Details-{{ forloop.index }}-{{ section.id }}" 
											class="disclosure-has-popup facets__disclosure facets__disclosure-price js-filter" 
											data-index="{{ forloop.index }}" 
											{% if filter_type == 'horizontal_united' %} open {% elsif filter_type == 'vertical' and default_open %} open {% endif %}>
											<summary class="facets__summary">
												<div class="facets__summary-inner">
													<span class="subtitle facets__summary-title">
														{{ filter.label | escape }}
														{% render 'icon-caret' %}
													</span>
												</div>
											</summary>
											<div id="Facet-{{ forloop.index }}-{{ section.id }}" class="facets__display">
												{% if filter_type == 'horizontal' %}
													<div class="facets__header">
														{%- assign max_price_amount = filter.range_max | money | strip_html | escape -%}
														<span class="facets__selected">
															{{ "sections.collection_template.max_price" | t: price: max_price_amount }}
														</span>
														<facet-remove>
															<a href="{{ filter.url_to_remove }}" class="facets__reset link">
																{{ 'products.facets.reset' | t }}
															</a>
														</facet-remove>
													</div>
												{% endif %}
												<price-range class="facets__price">
													{% liquid
														if uses_comma_decimals
															assign max_price = filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' 
														else
															assign max_price = filter.range_max | money_without_currency | replace: ',', '' 
														endif

														if uses_comma_decimals 
															if filter.min_value.value
																assign current_price_min = filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' 
																assign range_min = current_price_min | divided_by: max_price | times: 100
															else
																assign range_min = 0
																assign current_price_min = 0
															endif
														else 
															if filter.min_value.value
																assign current_price_min = filter.min_value.value | money_without_currency | replace: ',', '' 
																assign range_min = current_price_min | divided_by: max_price | times: 100
															else
																assign range_min = 0
																assign current_price_min = 0
															endif
														endif
														
														if uses_comma_decimals 
															if filter.max_value.value
																assign current_price_max = filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.'
																assign range_max = current_price_max | divided_by: max_price | times: 100
															else
																assign current_price_max = max_price
																assign range_max = 100 
															endif
														else 
															if filter.max_value.value
																assign current_price_max = filter.max_value.value | money_without_currency | replace: ',', '' 
																assign range_max = current_price_max | divided_by: max_price | times: 100
															else
																assign current_price_max = max_price
																assign range_max = 100
															endif	
														endif
													%}
													
													<div class="facets__price-wrapper">
														<label class="field__label {% if filter_type != 'horizontal' %} visually-hidden {% endif %}" for="Filter-{{ filter.label | escape }}-GTE">{{ 'products.facets.from' | t }}</label>
														<div class="field">
															<span class="field__currency">{{ cart.currency.symbol }}</span>
															<input class="field__input"
																name="{{ filter.min_value.param_name }}"
																id="Filter-{{ filter.label | escape }}-GTE"
															{%- if filter.min_value.value -%}
																{%- if uses_comma_decimals -%}
																	value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																	{%- else -%}
																	value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
																{% endif %}
															{% else %}
																value= "0"
															{%- endif -%}
																type="number"
																placeholder="0"
																min="0"
															{%- if uses_comma_decimals -%}max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"{%- else -%}max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"{% endif %}
															>
														</div>
														<label class="field__label {% if filter_type != 'horizontal' %} visually-hidden {% endif %}" for="Filter-{{ filter.label | escape }}-LTE">{{ 'products.facets.to' | t }}</label>
														<div class="field">
															<span class="field__currency">{{ cart.currency.symbol }}</span>
															<input class="field__input"
																		name="{{ filter.max_value.param_name }}"
																		id="Filter-{{ filter.label | escape }}-LTE"
																		{%- if filter.max_value.value -%}
																			{%- if uses_comma_decimals -%}value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}" {%- else -%}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
																		{% else %}
																			value ="{{ current_price_max }}"
																		{%- endif -%}
																		type="number"
																		min="0"
																	{%- if uses_comma_decimals -%}
																		placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																		max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																	{%- else -%}
																		placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
																		max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
																	{% endif %}
															>
														</div>
													</div>
													<div class="facets__range" style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%">
														<label class="visually-hidden" for="Filter-{{ filter.label | escape }}-Min">{{ 'products.facets.from' | t }}</label>
														<input 
															type="range" 
															value="{{ current_price_min }}" 
															min="0" 
															max = "{{ max_price }}"
															class="field__range"
															id="Filter-{{ filter.label | escape }}-Min"
														/>
														<label class="visually-hidden" for="Filter-{{ filter.label | escape }}-Max">{{ 'products.facets.to' | t }}</label>
														<input 
															type="range" 
															value="{{ current_price_max }}" 
															min="0" 
															max = "{{ max_price }}"
															class="field__range"
															id="Filter-{{ filter.label | escape }}-Max"
														/>
													</div>
												</price-range>
												{% if filter_type != 'horizontal' %}
													<facet-remove>
														<a href="{{ filter.url_to_remove }}" class="facets__reset link">
															{{ 'products.facets.reset' | t }}
														</a>
													</facet-remove>
												{% endif %}
											</div>
										</details>
									{% endif %}
								{% endcase %}
							{%- endfor -%}
							<noscript>
								<button type="submit" class="facets__button button">{{ 'products.facets.filter_button' | t }}</button>
							</noscript>
						</div>
					</div>
				{% endif %}

				{% if results.current_vendor or results.current_type %}
					<input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
				{% endif %}
			</form>
		</facet-filters-form>

		<menu-drawer class="mobile-facets__wrapper" data-breakpoint="mobile">
			<details class="disclosure-has-popup medium-hide large-up-hide">
				<summary>
					<span class="mobile-facets__open button button--primary focus-inset">
						{% render 'icon-filter' %}
						<span>
							{%- if enable_filtering and enable_sorting -%}
								{{ 'products.facets.filter_and_sort' | t }}
								{%- elsif enable_filtering -%}
								{{ 'products.facets.filter_button' | t }}
								{%- elsif enable_sorting -%}
								{{ 'products.facets.sort_button' | t }}
							{%- endif -%}
						</span>
						<div class="count-bubble">
							{%- if total_active_values > 0 -%}{{ total_active_values }}{%- endif -%}
						</div>
					</span>
					<span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js modal-close-button focus-inset">
						{%- render 'icon-close' -%}
					</span>
				</summary>
				<facet-filters-form>
					<form id="FacetFiltersFormMobile" class="mobile-facets">
						<div class="mobile-facets__inner">
							<div class="mobile-facets__header">
								<div class="mobile-facets__header-inner">
									<h2 class="mobile-facets__heading">
										{%- if enable_filtering and enable_sorting -%}
											{{ 'products.facets.filter_and_sort' | t }}
											{%- elsif enable_filtering -%}
											{{ 'products.facets.filter_button' | t }}
											{%- elsif enable_sorting -%}
											{{ 'products.facets.sort_button' | t }}
										{%- endif -%}
									</h2>
									<p class="mobile-facets__count">
										{%- if results.results_count -%}
											{{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
										{%- else -%}
											{{ 'products.facets.product_count_simple' | t: count: results.products_count }}
										{%- endif -%}
									</p>
								</div>
							</div>
							<div class="mobile-facets__main">
								{% if enable_filtering %}
									{%- for filter in results.filters -%}
										{% liquid
											assign presentation = filter.presentation | default: default_presentation
										%}
										{% case filter.type %}
										{% when 'boolean', 'list' %}
											{% liquid
												assign color_trigger = settings.trigger_swatch | handle | strip
												assign name_option = filter.label | handle | strip 
											%}
											<details id="Details-Mobile-{{ forloop.index }}-{{ section.id }}" class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
												<summary class="mobile-facets__summary">
													<div>
														<span>{{ filter.label | escape }}</span>
														<span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
														<noscript>{% render 'icon-caret' %}</noscript>
													</div>
												</summary>
												<div id="FacetMobile-{{ forloop.index }}-{{ section.id }}" class="mobile-facets__submenu">
													<button class="mobile-facets__close-button link link--text focus-inset" aria-expanded="true" type="button">
														{% render 'icon-caret' %}
														{{ filter.label | escape }}
													</button>
													<ul class="mobile-facets__list list-unstyled
														{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} mobile-facets__list--color 
														{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} mobile-facets__list--color 
                            {% elsif presentation == 'image' %} mobile-facets__list--image {%- endif -%}" 
														role="list"
														style= "--image_filter_columns: {{ image_filter_columns }};"
													>
														{%- for value in filter.values -%}
															{% liquid
																if settings.type_color_swatch == 'custom' and color_trigger == name_option
																	assign color_value = value.value | handle | strip
																	assign color_value_custom = color_value
																	
																	if settings.custom_colors != blank
																		assign custom_colors_string = settings.custom_colors | strip
																		assign custom_colors_obj = custom_colors_string | newline_to_br | split: '<br />'

																		for obj in custom_colors_obj
																			assign obj_strip = obj | strip
																			assign obj_key = obj_strip | split: ':' | first
																			assign obj_value = obj_strip | split: ':' | last
																			assign obj_color_name = obj_key | handle | strip

																			if color_value == obj_color_name
																				assign obj_color_value = obj_value
																				assign color_value_custom = obj_color_value | strip
																				break
																			endif
																		endfor
																	endif 
																endif

																assign swatch_value = null
                                if presentation == 'swatch'
                                  assign swatch = value.swatch
                                  if swatch.image
                                    assign image_url = swatch.image | image_url: width: 50
                                    assign swatch_value = 'url(' | append: image_url | append: ')'
                                    assign swatch_focal_point = swatch.image.presentation.focal_point
                                  elsif swatch.color
                                    assign swatch_value = 'rgb(' | append: swatch.color.rgb | append: ')'
                                  endif
                                endif
															%}
															<li class="mobile-facets__item list-menu__item 
																{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} mobile-facets__item--color 
																{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %} mobile-facets__item--color 
                                {% elsif presentation == 'image' %} mobile-facets__item--image {%- endif -%}"
																{% if settings.type_color_swatch == 'custom' and color_trigger == name_option %}
																	style="--swatch-color: {{ color_value_custom | remove: '-' }}; --border-radius: {{ settings.swatch_border_radius }}px;"
																{% elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' %}
                                  style="
                                    --border-radius: {{ settings.swatch_border_radius }}px;
                                    --swatch-color: {{ swatch_value }};
                                    {% if swatch_focal_point %} --swatch-focal-point: {{ swatch_focal_point }}; {% endif %}
                                  "
																{% endif %}>
																<input class="mobile-facets__checkbox" type="checkbox" name="{{ value.param_name }}" value="{{ value.value }}" id="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
																	{% if value.active %}checked{% endif %}
																	{% if value.count == 0 and value.active == false %}disabled{% endif %}
																>
																<label for="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}" 
																	class="mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}
																		{%- if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} facet-checkbox facet-checkbox--color 
																		{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%} facet-checkbox facet-checkbox--color 
                                    {% elsif presentation == 'image' %} facet-checkbox facet-checkbox--image {%- endif -%}" 
																		{%- if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} 
																			title="{{- value.label -}}" 
																		{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%}
																			title="{{- value.label -}}" 
																		{% endif %}
																	>
																	<span class="mobile-facets__highlight"></span>
																	{%- if presentation == 'image' -%}
                                    <div class="facets__image-wrapper" 
                                      style = "--image_filter_ratio: {{ image_filter_ratio }}; 
                                        --image_filter_fit: {{ image_filter_fit }};"
                                    >
                                      {% liquid
                                        assign width = 1000 | divided_by: image_filter_columns
                                      %}
                                      {% capture sizes %}
                                        calc((100vw - 50px) / {{ image_filter_columns }})
                                      {% endcapture %}
                                      {%- if value.image -%}
                                        {{
                                          value.image
                                          | image_url: width: value.image.width
                                          | image_tag: class: 'facets__image', alt: value.alt, sizes: sizes
                                        }}
                                      {%- endif -%}
                                    </div>
                                  {% else %}
																		<svg class="icon icon-checkmark" width="8" height="7" viewBox="0 0 8 7" fill="none" xmlns="http://www.w3.org/2000/svg">
																			<path d="M1 3.5L3 5.5L7 1.5" stroke="#F9F9F9" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
																		</svg>
																	{% endif %}
																	<span class="facet-checkbox__label
																		{% if settings.type_color_swatch == 'custom' and color_trigger == name_option -%} visually-hidden 
																		{%- elsif settings.type_color_swatch == 'standart' and presentation == 'swatch' -%} visually-hidden {%- endif -%}">
																		{{ value.label | escape }} 
																	</span>
																</label>
															</li>
														{%- endfor -%}
													</ul>

													<div class="no-js-hidden mobile-facets__footer">
														<facet-remove>
															<a href="{{ results_url }}" class="mobile-facets__clear button button--tertiary focus-inset">{{ 'products.facets.clear' | t }}</a>
														</facet-remove>
														<button type="button" class="no-js-hidden button button--primary focus-inset" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'products.facets.apply' | t }}</button>
														<noscript>
															<button class="button button--primary focus-inset">{{ 'products.facets.apply' | t }}</button>
														</noscript>
													</div>
												</div>
											</details>
										{% when 'price_range' %}
											<details id="Details-Mobile-{{ forloop.index }}-{{ section.id }}" class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
												<summary class="mobile-facets__summary">
													<div>
														<span>{{ filter.label | escape }}</span>
														<span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
														<noscript>{% render 'icon-caret' %}</noscript>
													</div>
												</summary>
												<div id="FacetMobile-{{ forloop.index }}-{{ section.id }}" class="mobile-facets__submenu">
													<button class="mobile-facets__close-button link link--text focus-inset" aria-expanded="true" type="button">
														{% render 'icon-caret' %}
														{{ filter.label | escape }}
													</button>

													<p class="mobile-facets__info">
														{{ "sections.collection_template.max_price" | t: price: max_price_amount }}
													</p>

													<price-range class="facets__price">
														<div class= "facets__price-wrapper">
															<div class="field">
																<span class="field__currency">{{ cart.currency.symbol }}</span>
																<input class="field__input"
																			name="{{ filter.min_value.param_name }}"
																			id="Mobile-Filter-{{ filter.label | escape }}-GTE"
																		{%- if filter.min_value.value -%}
																			{%- if uses_comma_decimals -%}
																				value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																			{%- else -%}
																				value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
																			{% endif %}
																		{% else %}
																			value= "0"
																		{%- endif -%}
																			type="number"
																			placeholder="0"
																			min="0"
																			max="{{ filter.range_max | divided_by: 100 | ceil }}"
																	>
															</div>
															<div class="field">
																<span class="field__currency">{{ cart.currency.symbol }}</span>
																<input class="field__input"
																			name="{{ filter.max_value.param_name }}"
																			id="Mobile-Filter-{{ filter.label | escape }}-LTE"
																		{%- if filter.max_value.value -%}
																			{%- if uses_comma_decimals -%}
																				value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
																			{%- else -%}
																				value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
																			{% endif %}
																		{% else %}
																			value ="{{ current_price_max }}"
																		{%- endif -%}
																			type="number"
																			placeholder="{{ filter.range_max | divided_by: 100 | ceil }}"
																			min="0"
																			max="{{ filter.range_max | divided_by: 100 | ceil }}"
																	>
															</div>
														</div>
														<div class="facets__range" style="--range-min: {{ range_min }}%; --range-max: {{ range_max }}%">
															<label class="visually-hidden" for="Filter-{{ filter.label | escape }}-Min-mobile">{{ 'products.facets.from' | t }}</label>
															<input 
																type="range" 
																value="{{ current_price_min }}" 
																min="0" 
																max = "{{ max_price }}"
																class="field__range"
																id="Filter-{{ filter.label | escape }}-Min-mobile"
															/>
															<label class="visually-hidden" for="Filter-{{ filter.label | escape }}-Max-mobile">{{ 'products.facets.to' | t }}</label>
															<input 
																type="range" 
																value="{{ current_price_max }}" 
																min="0" 
																max = "{{ max_price }}"
																class="field__range"
																id="Filter-{{ filter.label | escape }}-Max-mobile"
															/>
														</div>
													</price-range>
													<div class="no-js-hidden mobile-facets__footer">
														<facet-remove>
															<a href="{{ results_url }}" class="mobile-facets__clear button button--tertiary focus-inset">{{ 'products.facets.clear' | t }}</a>
														</facet-remove>
														<button type="button" class="no-js-hidden button button--primary focus-inset" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'products.facets.apply' | t }}</button>
														<noscript>
															<button class="button button--primary focus-inset">{{ 'products.facets.apply' | t }}</button>
														</noscript>
													</div>
												</div>
											</details>
										{% endcase %}
									{%- endfor -%}
								{% endif %}

								{%- if enable_sorting -%}
									<div class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
										<div class="mobile-facets__summary">
											<div class="mobile-facets__sort">
												<label for="SortBy-mobile">{{ 'products.facets.sort_by_label' | t }}</label>
												<div class="select field">
													<select name="sort_by" class="select__select" id="SortBy-mobile" aria-describedby="a11y-refresh-page-message">
                                                      {%- assign sort_by = sort_by | default: "title-ascending" -%}
														{%- for option in results.sort_options -%}
															<option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
														{%- endfor -%}
													</select>
													{% render 'icon-caret' %}
												</div>
											</div>
										</div>
									</div>
								{%- endif -%}

								<div class="mobile-facets__footer">
									<facet-remove>
										<a href="{{ results_url }}" class="mobile-facets__clear button button--tertiary focus-inset">{{ 'products.facets.clear_all' | t }}</a>
									</facet-remove>
									<button type="button" class="no-js-hidden button button--primary focus-inset" onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()">{{ 'products.facets.apply' | t }}</button>
									<noscript>
										<button class="button button--primary focus-inset">{{ 'products.facets.apply' | t }}</button>
									</noscript>
								</div>
							</div>

							{% if results.current_vendor or results.current_type %}
								<input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
							{% endif %}

							{%- if results.terms -%}
								<input type="hidden" name="q" value="{{ results.terms | escape }}">
								<input name="options[prefix]" type="hidden" value="last">
							{%- endif -%}
						</div>
					</form>
				</facet-filters-form>
			</details>
		</menu-drawer>

	<div class="active-facets active-facets-mobile medium-hide large-up-hide">
		{%- for filter in results.filters -%}
			{%- for value in filter.active_values -%}
				<facet-remove>
					<a href="{{ value.url_to_remove }}" class="active-facets__button focus-inset">
            <span class="active-facets__button-inner">
							<span>{{ filter.label }}:</span>
              {{ value.label | escape }}
							<span class="active-facets__button-close">{% render 'icon-close' %}</span>
              <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
            </span>
					</a>
				</facet-remove>
			{%- endfor -%}

			{%- if filter.type == "price_range" -%}
				{%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
					<facet-remove>
						<a href="{{ filter.url_to_remove }}" class="active-facets__button focus-inset">
              <span class="active-facets__button-inner">
								<span>{{ filter.label }}:</span>
                {%- if filter.min_value.value -%}{{ filter.min_value.value | money }}{%- else -%}{{ 0 | money }}{%- endif -%}-{%- if filter.max_value.value -%}{{ filter.max_value.value | money }}{%- else -%}{{ filter.range_max | money }}{%- endif -%}
								<span class="active-facets__button-close">{% render 'icon-close' %}</span>
                <span class="visually-hidden">{{ 'products.facets.clear_filter' | t }}</span>
              </span>
						</a>
					</facet-remove>
				{%- endif -%}
			{%- endif -%}
		{%- endfor -%}
		<facet-remove>
			<a href="{{ results_url }}" class="active-facets__button-remove focus-inset">
				<span>{{ 'products.facets.clear_all' | t }}</span>
			</a>
		</facet-remove>
	</div>
	<span id="ProductCount" class="visibility-hidden">
		{%- if results.results_count -%}
			{{ 'templates.search.results_with_count' | t: terms: results.terms, count: results.results_count }}
		{%- else -%}
			{{ 'products.facets.product_count_simple' | t: count: results.products_count }}
		{%- endif -%}
	</span>
</div>